# MatrixOne 功能特性

MatrixOne 实现了三个独立的层级，每个层级都有自己的对象单元和分工。不同类型的节点可以自由伸缩，不再受到其他层的制约。这三个层级是：

![](https://github.com/matrixorigin/artwork/blob/main/docs/overview/architecture/architecture-1.png?raw=true)

- 计算层：以计算节点 Compute Node (简称 CN) 为单位，实现了计算和事务处理的 Serverless 化，具备自己的缓存，可以任意重启和扩缩容。
- 事务层：以数据库节点 Database Node 和日志节点 Log Service 为单位，提供完整的日志服务和元数据信息，内置 Logtail 用于保存最近的数据。
- 存储层：全量数据保存在对象存储中，以 S3 为代表，实现了低成本的无线伸缩存储方式。统一的文件操作服务 File Service 实现了不同节点对底层存储的无感知操作。

![](https://github.com/matrixorigin/artwork/blob/main/docs/overview/architecture/architecture-2.png?raw=true)

在确定了 TAE 作为唯一存储引擎之后，对融合后的 TAE 引擎进行了多项设计上的调整，才有了后来的 TAE 存储引擎。这个引擎具有如下优势：

- 列存管理：统一的列存和压缩方式，对于 OLAP 业务具有先天的性能优势。
- 事务处理：共享日志和 DN 节点共同完成对计算节点的事务支持。
- 冷热分离：使用 S3 对象存储作为目标的 File Service，每个计算节点都有自己的缓存。

![](https://github.com/matrixorigin/artwork/blob/main/docs/overview/architecture/architecture-3.png?raw=true)

计算引擎基于兼容 MySQL 的根本目标，对于节点调度、执行计划和 SQL 能力有着更高的要求。高性能计算引擎既具备实验架构中计算引擎的 MPP：

- 兼容 MySQL：具有对 MySQL 协议和语法的支持。
- 融合引擎：基于 DAG 重新构建执行计划，可以同时执行 TP 和 AP。
- 节点调度：未来可支持自适应节点内和节点间调度，同时满足并发和并行执行。
- 完善的 SQL 能力：支持子查询、窗口函数、CTE、Spill 内存溢出处理等。

## MatrixOne 关键性能

### 高效存储

MatrixOne 选择 AWS S3 作为一款高效的存储方案，满足了低成本和冷热数据分离这两个核心需求。其可靠的可用性保证了公有云中的低风险，并提供私有化部署的兼容版本。

- 低成本：降低冗余度，获得性能可接受的更低成本。
- 冷热数据分离：必要的条件，实现对数据的精细管理。

### 明确的事务分工

- CN 负责所有的计算和事务逻辑，DN 负责保存元数据、日志信息和事务裁决。
- 引入 Logtail 对象在日志中，用于保存最近日志中的关联数据。将 Logtail 的数据定期写入 S3 中。CN 扩容可以实时将 Logtail 数据同步至 Cache，实现部分数据共享。
- 设置事务大小的阈值。超过阈值的事务直接写入 S3，日志只记录写入记录。未超过阈值的事务继续由 DN 写入，极大增加了吞吐量。

### HTAP 工作负载隔离

作为 HTAP 数据库，实现了不同类型的工作负载隔离：

- 服务器级别的隔离：在硬件资源充足的情况下，各个组件分别在不同的物理机运行，接入同一个对象存储。
- 容器级别的隔离：在硬件资源有限的情况下，利用所有节点无状态的特性，以容器作为各个节点的隔离手段。

### 灵活的资源配比

作为 HTAP 数据库，不同业务场景的比例在不断动态变化，对资源的配比也有着更高的要求。旧架构下的资源分配模式注定无法实现灵活调整，需要对各个节点实现更加精细化的管理，包括但不限于：

- CN 节点的分工：允许用户对 CN 进行划分，用于 TP 或 AP 业务。在某项业务资源出现瓶颈时，对 CN 进行水平扩容。
- 动态判断不同业务 CN 组的负载情况，可以自动将闲置资源分配至繁忙组内。
- 通过租户（account）的逻辑概念，实现逻辑资源的完全隔离。不同租户可以以独享或共享的方式使用指定 CN 资源。
